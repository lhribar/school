---
title: "Teža možganov pri sesalcih"
author: "Luka Hribar"
header-includes:
- \usepackage[utf8]{inputenc}
output:
  pdf_document: default
  html_document: default
  word_document: default
---




# 1. Opis podatkov

Meritve telesne teže in teže možganov na vzorcu 58 vrst sesalcev:
\begin{enumerate}
\item $vrsta$ je nominalna spremenljivka, katere vrednosti so latinski nazivi vrste sesalcev.
\item $slovime$ je nominalna spremenljivka, katere vrednosti so slovenski nazivi vrste sesalcev 
\item $telteza$ je numerična zvezna spremenljivka, ki predstavlja telesno težo (v kilogramih).
\item $mozteza$ je numerična zvezna spremenljivka, ki predstavlja težo možganov (v kiogramih).
\end{enumerate}
Baza podatkov se imenuje \emph{mozgani.csv}. Najprej bomo prebrali podatke v R, in 
zatem pogledali strukturo podatkov

```{r}
mozgani<-read.csv("C:/Users/lukah/OneDrive/Dokumenti/mozgani.csv", header=TRUE)
str(mozgani)
mozgani$logtelteza<-log(mozgani$telteza)
mozgani$logmozteza<-log(mozgani$mozteza)
```


# 2. Opisna statistika

Zdaj bomo izračunali opisno statistiko za naše podatke – povzetek s petimi 
števili (minimum, maksimum, prvi in tretji kvartil, mediano), vzorčni povprečji 
in vzorčna standardna odklona telesne teže in teže možganov.

```{r}
summary(mozgani$telteza)
sd(mozgani$telteza)

```
```{r}
summary(mozgani$logtelteza)
sd(mozgani$logtelteza)
```
Opazimo, da telesna teža sesalcev varira od $0.005$ do $6644.18$ kg, s povprečjem $212.428$ in standardnim odklonom $928.6204$ kg. ker telesna teža toliko varira, in je standardni odklon tako velik, je boljše, da uporabimo transformirane podatke (naravni logaritem telesne teže). Po tej transformaciji dobimo, da telesna teža varira od $-5.3$ do $8.8$ kg, s povprečjem $1.5$ in standardnim odklonom $3.13$ kg
Ponovimo postopek računanja za vzorec teže možganov.
```{r}
summary(mozgani$mozteza)
sd(mozgani$mozteza)
```

```{r}
summary(mozgani$logmozteza)
sd(mozgani$logmozteza)
```
Opazimo, da teža možganov sesalca varira od $0.14$ do $5711.86$ g, s povprečjem $302.32$ in standardnim odklonom $959.34$ g. Prav tako je pri teh podatkov takšna razlika, zato tudi tu uporabimo transformirane podatke (naravni logaritem teže možganov). Po transformaciji dobimo, da teža možganov varira od $-1.97$ do $8.65$ g, s povprečjem $3.29$ in standardnim odklonom $2.44$. Razpon vrednosti telesne teže sesalcev in teže možganov sesalcev nam pomaga pri izbiri mej na oseh razsevnega diagrama.

# 3. Razsevni diagram in vzorčni koeficient korelacije

Prikažimo dobljene podatke na razsevnem diagramu.
     

```{r}
par(las=1, cex=1.1, mar=c(4,4,2,2))
plot(mozgani$logtelteza, mozgani$logmozteza, main="", xlim=c(-6,9), ylim=c(-2,9),
xlab = expression(Telesna~teža~(kg)~("log")), ylab=expression(teža~možganov~(g)~("log")), lwd=2, axes=FALSE)
axis(1,pos=0,at=seq(-6,9,by=3),tcl=-0.2)
axis(2,pos=0,at=seq(-2,9,by=3),tcl=-0.2)
arrows(x0=0,y0=0,x1=9,y1=0,length=0.1)
arrows(x0=0,y0=0,x1=0,y1=9,length=0.1)
```


Točke na razsevnem diagramu se nahajajo okoli namišljene premice, tako da 
linearni model zaenkrat izgleda kot primeren. Moč korelacije preverimo še z 
računanjem Pearsonovega koeficienta korelacije, kjer uporabimo logaritmirane podatke.

```{r}
(r<-cor(mozgani$logtelteza,mozgani$logmozteza))
```

Vrednost vzorčnega koeficienta korelacije je visoka ($r=0.963$), kar govori o 
visoki linearni povezanosti telesne teže in teže možganov sesalcev. Dalje, 
koeficient korelacije je pozitiven, kar pomeni, da imajo sesalci z višjo telesno težo tudi višjo težo možganov.

# 4. Formiranje linearnega regresijskega modela

Formirajmo linearni regresijski model s transformiranimi podatki.
```{r}
(model<-lm(logmozteza~logtelteza,data=mozgani))
```

Dobili smo ocenjeno regresijsko premico $\hat{y}=2.17 + 0.749x$, oziroma oceni 
odseka in naklona sta enaki $\hat{a}=2.17$ in $\hat{b}=0.749$. 

# 5. Točke visokega vzvoda in osamelci

Identificirajmo točke visokega vzvoda in osamelce. Vrednost $x$ je točka 
visokega vzvoda, če je njen transformirani vzvod večji od $\frac{4}{n}$. 

```{r}
mozgani[hatvalues(model)>4/nrow(mozgani),]
```

Odkrili smo 4 točke visokega vzvoda. Gledamo transformirane podatke. 2 sesalca imata visoko telesno težo 
nad 7.5 kg in 2 sesalca telesno težo pod -4.5 kg. 

Za podatke majhne in srednje velikosti vzorca je osamelec podatkovna točka, 
kateri ustreza standardizirani ostanek izven intervala $[-2, 2]$. 

```{r}
mozgani[abs(rstandard(model))>2,]
```

Identificirali smo dve podatkovni točki (28. in 30. točka) kot osamelca.
Zdaj poglejmo na razsevnem diagramu po čem sta te točki drugačni od ostalih. 
Kodi za razsevni diagram dodamo če dve vrstici, s katerima bomo dodali ocenjeno 
regresijsko premico in pobarvali te dve točki.

```{r, fig.align="center",out.width="90%"}
par(las=1, cex=1.1, mar=c(4,4,2,2))
plot(mozgani$logtelteza, mozgani$logmozteza, main="", xlim=c(-6,9), ylim=c(-2,9),
xlab = expression(Telesna~teža~(kg)~("log")), ylab=expression(teža~možganov~(g)~("log")), lwd=2, axes=FALSE)
axis(1,pos=0,at=seq(-6,9,by=3),tcl=-0.2)
axis(2,pos=0,at=seq(-2,9,by=3),tcl=-0.2)
arrows(x0=0,y0=0,x1=9,y1=0,length=0.1)
arrows(x0=0,y0=0,x1=0,y1=9,length=0.1)
abline(model,lwd=2)
points(mozgani$logtelteza[c(28,30)],mozgani$logmozteza[c(28,30)],col="blue",pch=19)
text(mozgani$logtelteza[c(28,30)],mozgani$logmozteza[c(28,30)]+c(0.2,0),labels=
mozgani$slovime[c(28,30)],pos=3,cex=0.8)
```

Na razsevnem diagramu opazimo, da se omenjena osamelca nanašata na dva sesalca z 
nenavadno veliko transformirano težo možganov glede na njihovo telesno težo. Opazimo tudi, da na grafu ni nobene podatkovne točke, ki bi bila hkrati osamelec in točka visokega vzvoda.


# 6. Preverjanje predpostavk linearnega regresijskega modela

Predpostavke linearnega regresijskega modela bomo preverili s štirimi grafi, ki 
se imenujejo diagnostični grafi (ali grafi za diagnostiko modela). Če neke 
predpostavke modela niso izpolnjene, so lahko ocene neznanih parametrov, 
$p$-vrednost testa, intervali zaupanja in intervali predikcije netočni.


```{r}
par(mfrow=c(2,2),mar=c(4,3,2,1))
plot(model,which=1,caption="",ann=FALSE)
title(xlab=expression(italic(widehat(y)==widehat(a)+widehat(b)*x)),
ylab="Ostanki",main="Linearnost modela")
plot(model,which=2,caption="", ann=FALSE)
title(xlab="Teoretični kvantili", ylab= "St. ostanki",
main="Normalnost porazdelitve")
plot(model,which=3,caption="",ann=FALSE)
title(xlab=expression(italic(widehat(y)==widehat(a)+widehat(b)*x)),
ylab=expression(sqrt(paste("|St. ostanki|"))), main="Homogenost variance")
plot(model,which=4,caption="", ann=FALSE)
title(xlab="Meritev",ylab="Cookova razdalja", main="Vpliv točk na model")
```


## 1) Graf za preverjanje linearnosti modela
Validnost linearnega regresijskega modela lahko preverimo tako, da narišemo graf 
ostankov v odvisnosti od $x$ vrednosti ali od predvidenih vrednosti 
$\hat{y}$ = $\hat{a}x$ + $\hat{b}$ in preverimo, če obstaja kakšen vzorec. Če so 
točke dokaj enakomerno raztresene nad in pod premico $Ostanki = 0$ in ne moremo 
zaznati neke oblike, je linearni model validen. Če na grafu opazimo kakšen 
vzorec (npr. točke formirajo nelinearno funkcijo), nam sama oblika vzorca daje 
informacijo o funkciji od $x$, ki manjka v modelu.

Za uporabljene podatke na grafu linearnosti modela ne opazimo vzorca ali 
manjkajoče funkcije in lahko zaključimo, da je linearni model validen. Točke na 
grafu ne izgledajo popolnoma naključno razporejene, opažamo večjo koncentracijo 
točk za predvidene vrednosti od 0 do 6, kar je prisotno zaradi originalnih 
vrednosti v vzorcu možganov (poglej razsevni diagram).

## 2) Graf normalnosti porazdelitve naključnih napak
Normalnost porazdelitve naključnih napak preverjamo preko grafa porazdelitve 
standardiziranih ostankov. Na $x$-osi Q - Q grafa normalne porazdelitve so 
podani teoretični kvantili, na $y$ - osi pa kvantili standardiziranih ostankov. 
Če dobljene točke na Q-Q grafu tvorijo premico (z manjšimi odstopanji), 
zaključimo, da je porazdelitev naključnih napak (vsaj približno) normalna.

Za podatke o telesni teži in teži možganov sesalcev lahko zaključimo, da so naključne 
napake normalno porazdeljene (ni večjih odstopanj od premice, razen za 42., 30., 
in 28. podatkovno točko).

## 3) Graf homogenosti variance
Učinkovit graf za registriranje nekonstantne variance je graf korena 
standardiziranih ostankov v odvisnosti od $x$ ali od predvidenih vrednosti
$\hat{y} = \hat{a}x + \hat{b}$. Če variabilnost korena standardiziranih ostankov 
narašča ali pada s povečanjem vrednosti $\hat{y}$, je to znak, da varianca 
naključnih napak ni konstantna. Pri naraščanju variance je graf pogosto oblike 
$\triangleleft$, in pri padanju variance oblike $\triangleright$. Pri 
ocenjevanju lahko pomaga funkcija glajenja, v primeru konstantne variance se 
pričakuje horizontalna črta, okoli katere so točke enakomerno razporejene.

Za naš primer, točke na grafu sugerirajo, da ni naraščanja ali padanja variance. 


## 4) Graf vpliva posameznih točk na model
Vpliv $i$-te točke na linearni regresijski model merimo s Cookovo razdaljo 
$D_{i}$, $1\le i\le n$. Če $i$-ta točka ne vpliva močno na model, bo $D_i$ 
majhna vrednost. Če je $D_i \geq c$, kjer je $c = F_{2,n-2;0.5}$ mediana 
Fisherjeve porazdelitve z $2$ in $n- 2$ prostostnima stopnjama, $i$-ta točka 
močno vpliva na regresijski model.


Na grafu vpliva točk na linearni regresijski model so vedno označene tri točke z 
najvišjo Cookovo razdaljo. Za naše podatke, to so 28., 30., in 49. podatkovne 
točka. Spomnimo se, da smo te točke identificirali kot osamelce.
Na razsevnem diagramu opazimo, da so vse tri točke najbolj oddaljene od ocenjene 
regresijske premice (oziroma jim ustrezajo največji ostanki). Lahko preverimo še, 
ali je njihov vpliv velik, oziroma ali je njihova Cookova razdalja večja ali 
enaka od mediane Fisherjeve porazdelitve z 2 in 56 prostostnimi stopnjami.

```{r}
any(cooks.distance(model)[c(28,30,49)]>=qf(0.5,2,nrow(mozgani)-2))
```
Nobena od teh točk nima velikega vpliva na linearni regresijski model, zato jih 
ni potrebno odstraniti.

# 7. Testiranje linearnosti modela in koeficient determinacije
Poglejmo R-jevo poročilo o modelu.
```{r}
summary(model)
```
Vrednost testne statistike za preverjanje linearnosti modela je enaka 
$t= 26.85$, s $df= 56$ prostostnimi stopnjami in s p-vrednostjo 
$p = 2 \cdot 10^{-16}$, ki je manjša od dane stopnje značilnosti $0.05$. Na 
osnovi rezultatov t-testa zavrnemo ničelno domnevo $H_0 : b = 0$, za dano 
stopnjo značilnosti in dobljeni vzorec. Drugače rečeno, s formalnim statističnim 
testiranjem smo pritrdili, da linearni model ustreza podatkom.

Koeficient determinacije je enak $R^2 = 0.928$, kar pomeni, da $93\%$ 
variabilnosti teže možganov pojasnjuje linearni regresijski model.


# 8. Interval predikcije za vrednost $Y$ pri izbrani vrednosti $X$
Pri predvidevanju vrednosti teže možganov nas zanima bodoča vrednost 
spremenljivke Y pri izbrani vrednosti spremenljivke $X = x_0$. Ne zanima nas le 
predvidena vrednost $\hat{y} = 2.17 + 0.749x_0$ sesalcev določene telesne teže 
$x_0$, ampak želimo tudi oceniti spodnjo in zgornjo mejo, med katerima se 
verjetno nahaja teža možganov različnih sesalcev teh telesnih tež.


```{r}
xlogtelteza = data.frame(logtelteza=log(c(100,500,1000)))
exp(predict(model, xlogtelteza, interval="predict"))
```
Predvidena vrednost teže možganov za sesalce (na celi populaciji 
sesalcev)
\begin{enumerate}
\item 100 kg je 274.02 g, s $95\%$ intervalom predikcije teže možganov 
$[71.47, 1050.57]$,
\item 500 kg je 914.08 g, s $95\%$ intervalom predikcije teže možganov
$[234.98, 3555.75]$,
\item 1000 kg je 1535.73 g, s $95\%$ intervalom predikcije teže možganov
$[391.64, 6022.11].$
\end{enumerate}

```{r}
predict(model, xlogtelteza, interval="predict")
```

če podatke transformiramo, dobimo predvideno vrednost teže možganov
\begin{enumerate}
\item 100 (4.61 $log$) kg je 5.61 g, s $95\%$ intervalom predikcije teže možganov
$[4.27, 6.96]$,
\item 500 (6.21 $log$) kg je 6.82 g, s $95\%$ intervalom predikcije teže možganov
$[5.46, 8.18]$,
\item 1000 (6.91 $log$) kg je 7.34 g, s $95\%$ intervalom predikcije teže možganov
$[5.97, 8.7].$
\end{enumerate}


# 9. Zaključek
Zanimala nas je funkcionalna odvisnost med logaritmirano telesno težo sesalcev (merjeno v kg) in njihovo logaritmirano težo možganov (merjeno v g). Zbrali smo vzorec 58 sesalcev, jim izmerili telesno težo in zabeležili težo možganov. 
Ugotovili smo, da je enostavni linearni model odvisnosti telesne teže od teže možganov ni
dober, zato smo morali transformirati podatke. Diagnostični grafi in statistični testi niso pokazali na težave z 
linearnim regresijskim modelom. Koeficient determinacije je $93\%$, kar pomeni, 
da tolikšen delež variabilnosti teže možganov zajamemo z linearnim modelom. 
Napoved teže možganov na osnovi njihove telesne teže je zadovoljiva, vendar bi 
vključevanje dodatnih neodvisnih spremenljivk zagotovo dala še boljši model in 
bolj zanesljivo napoved.
